v 1.0, A. Bulgarelli, AGILE Team, 17 Jan 2008

Introduzione scripts
----------------------------------------------
In questo README sono descritti i seguenti script ruby:
- generateMAP.rb: genera cts, exp e gas map
- makeALIKESINGLE.rb: esegue la ALIKE singola
- makeALIKELIST.rb: esegue la ALIKE multipla
- makeALIKELOC.rb

nella directory ~/ADC/scripts/

Il primo parametro di ogni script e il nome del filtro. I valori ammessi sono i seguenti:
- F4
- FT3
- FT3ab
In base a questo parametro sono determinate le matrici di calibrazione corrispondenti.

Gli scripts possono essere lanciati da qualunque posizione poiche' fanno riferimento ai tools GRID mediante path assoluto.
Ogni utente si ritrovera' nella sua home le seguenti directory (o link relativi)
- ADC, in cui sono installati i tools 

Esecuzione in modalita' batch dei comandi
-----------------------------------------------
Tutti gli script di seguito elencati possono essere eseguiti in modalita' batch (cioe' si puo' lanciare lo script e poi chiudere la sessione) nel seguente modo

nohup ruby ~/grid_scripts/<nome dello script> <elenco dei parametri> &

Vedere l'esempio sul generateMAP.rb.

generateMAP.rb (e mergeSkyMaps.sh )
-----------------------------------------------
Questo script genera cts, exp e gas con parametri coerenti tra loro.
Elenco parametri
#0) filter type (F4, FT3ab, FT3)
#1) output file name prefix
#2) tstart (in TT)
#3) tstop (in TT)
#4) l
#5) b
#6) energy min
#7) energy max
#8) fov (60)
#9) map size (diameter of the map in degree)
#10) bin size (0.5, 0.3)
#11) albedorad (default 80, optional)
#12) projection (default ARC, AIT, optional)
#13) step size of exp map gen (default 1, optional)
#14) sky map file name (optional, absolute path)

Esempio di uso. 
Portarsi nella directory ~/data, poi digitare il comando:

ruby ~/grid_scripts/generateMAP.rb FT3ab TEST3 125259064.417961 125265190.305564  270 0 100 50000 60 50 0.1

crea le tre mappe per il filtro FT3ab con i nomi TEST3.cts.gz, TEST3.exp.gz, TEST3.gas.gz (e crea anche l'intensity TEST3.int.gz se il tool è installato) con i tempi da 125259064.417961 a 125265190.305564 centrate in l=270, b=0, con energia min 100 MeV ed energia max 99999 MeV, con fov di 60 gradi e mapsize di 50 gradi e con bin size di 0.1.

Parametri opzionali:
- albedorad
- projection delle mappe (solo ARC o AIT)
- step size di approssimazione per il task AG_expmapgen. Se si usa 1 non viene usato l'algoritmo di approssimazione
- sky map file name, se serve. Nuovi sky map possono essere generati con il task mergeSkyMaps.sh a partire dagli sky map correnti.

Se si specifica un energy max > 50000 il task genera errore. Questo perche' il task tenta di determinare la sky map per il task di AG_gasmapgen dai range specificati in input.

Tutti i parametri fino al bin size sono obbligatori, gli altri opzionali.

Le mappe non devono esistere gia', altrimenti il software va in errore.

Per lanciare il comando in modalita' batch (cioe' si lancia e poi e' possibile scollegarsi) lo si deve usare come nel seguente esempio:

nohup ruby ~/grid_scripts/generateMAP.rb test3.cts test3.exp test3.gas 125259064.417961 125265190.305564  270 0 100 50000 60 50 0.1 &

cioe' si mette all'inizio il comando nohup e lo si termina con &.

makeALIKELIST.rb
------------------------------------------------
Esegue la ALIKE multi source.

Elenco dei parametri:

#0) filter type (F4, FT3ab, FT3)
#1) cts
#2) exp
#3) gas
#4) spectralindex
#5) energy min
#6) energy max
#7) min TS
#8) file name of the list
#9) radius of analysis (10, 15)
#10) outfile
#11) gas coefficient (optional)
#12) iso coefficient (optional)
#13) diagnostic file (optional)

Esempio:

ruby ~/grid_scripts/makeALIKELIST.rb FT3ab virgo-7ft.cts virgo-7ft.exp virgo-7ft.gas 2.1 100 50000 2 virgo.det outfile.txt

dove il primo parametro e' il nome del filtro (vedi Introduzione), i parametri successivi sono le 3 mappe (path assoluto o relativo), poi segue l'indice spettrale (ricordo comunque che per ora e' fisso a 2.1 sempre), poi segue energia minima e massima (le stesse usate nella generazione delle mappe), poi segue il valore minimo di TS al di sopra del quale i risultati sono scritti nel file di output. Gli ultimi due parametri obbligatori sono la lista e il file di output.
I parametri opzionali consentono di specificare un valore da fissare per il parametro gas e uno per il parametro iso. Se non specificati, i parametri gas e iso sono liberi. L'ultimo parametro è il nome del diagnostic file.

Esempio di lista

La lista da dare in input e' un file testuale con le seguenti colonne:
1 0+/-0 1 1 1 17.94   0.14 1 1 0.00E+0 0 
2 0+/-0 1 1 1 16.37  -1.16 1 1 0.00E+0 0 
3 0+/-0 1 1 1 18.47  -0.44 1 1 0.00E+0 0


Al momento, le uniche colonne significative sono quelle che contengono le coordinate.

makeALIKESINGLEfixed.rb
-----------------------------------------------
Esegue la ALIKE a singola sorgente.

Elenco dei parametri:

#0) filter type (F4, FT3ab, FT3)
#1) cts
#2) exp
#3) gas
#4) spectralindex
#5) l
#6) b
#7) energy min
#8) energy max
#9) radius of analysis (10, 15)
#10) outfile
#11) gas coefficient (optional)
#12) iso coefficient (optional)


Esempio

ruby ~/grid_scripts/makeALIKESINGLEfixed.rb F4 virgo-7.cts virgo-7.exp virgo-7.gas 2.1 288.0 61.5 100 50000 10 outfilename.txt

dove il primo parametro  e' il nome del filtro (vedi Introduzione), i parametri successivi sono le 3 mappe (path assoluto o relativo), poi segue l'indice spettrale, quindi le coordinate l e b,  energia minima e massima (le stesse usate nella generazione delle mappe), il raggio di analisi (usalmente 10 o 15) ed infine il nome del file di output.
I parametri opzionali consentono di specificare un valore da fissare per il parametro gas e uno per il parametro iso. Se non specificati, i parametri gas e iso sono liberi.
 
makeALIKELOC.rb
-----------------------------------------------
Esegue la ALIKE location.

Elenco dei parametri:

#0) filter type (F4, FT3ab, FT3)
#1) cts
#2) exp
#3) gas
#4) spectral index
#5) start l
#6) start b
#7) energy min
#8) energy max
#9) radius of analysis (10, 15)
#10) outfile
#11) gas coefficient (optional)
#12) iso coefficient (optional)

Esempio

ruby ~/grid_scripts/makeALIKELOC.rb F4 virgo-7.cts virgo-7.exp virgo-7.gas 2.1 288.0 61.5 100 50000 10 outfilename.txt

dove il primo parametro  e' il nome del filtro (vedi Introduzione), i parametri successivi sono le 3 mappe (path assoluto o relativo), poi segue l'indice spettrale, quindi le coordinate iniziali l e b,  energia minima e massima (le stesse usate nella generazione delle mappe), il raggio di analisi (usalmente 10 o 15) ed infine il nome del file di output.
I parametri opzionali consentono di specificare un valore da fissare per il parametro gas e uno per il parametro iso. Se non specificati, i parametri gas e iso sono liberi.



 
